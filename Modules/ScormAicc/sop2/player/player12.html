<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" id="scormplayer">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<title>ILIAS SCORM Offline Player</title>
	<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
	<script type="text/javascript" src="../Modules/ScormAicc/scripts/SOP12API.js"></script>
	<script type="text/javascript" src="../Modules/ScormAicc/scripts/jquery-min.js"></script>
	<script type="text/javascript" src="../Modules/ScormAicc/scripts/sop2.js"></script>
	<style type="text/css">
body{
	margin:0;
}
#zmove{
	background: url(images/transparent.gif) 0 0 repeat;
	position:absolute;
	width:100%;
	height:100%;
	z-index:7;
	display:none;
}
#leftView{
	width:230px;
	position:absolute;
	float:left;
	top:0px;
	bottom:0;
	font-family:Arial,sans-serif;
	font-size:90%;
}
#leftView a{
	text-decoration: none;
	cursor: pointer;
}
#dragbar{
	background-color:#D0D0D0;
	z-index:8;
	width:2px;
	cursor:col-resize;
	position:absolute;
	top:0px;
	bottom:0px;
	left:230px;
}
#tdResource{
	float:right;
	position:absolute;
	right:0;
	top:0px;
	bottom:0px;
	left:232px;
}
	</style>
</head>
<body>
	<div id="zmove"></div>
	<div id="mainTable">
		<div id="leftView">
			<div id="treeView"></div>
		</div>
		<div id="dragbar"></div>
		<div id="tdResource">
			<iframe src="../Modules/ScormAicc/templates/default/dummy.html" name="sahs_content" style="width:100%;height:100%" frameborder="0"></iframe>
			<iframe src="../Modules/ScormAicc/templates/default/debug.html" name="logframe" style="width:100%;height:0" frameborder="0"></iframe>
		</div>
	</div>

	
	<script type="text/javascript">
		somInitialized=false;
		IliasScormVars={};
		IliasScormData=[];
		IliasScormResources=[];
		IliasScormTree=[];
		var SOP=true;
		var API;
		var params;
		// ToDo: WebAccessChecker Test
		function initPlayer() { //ToDo: check offline access! Not allow online access: look into in offline storage first
			params = gui.getPlayerParams(window);
			gui.log(params);
			var d = JSON.parse(localStorage.getItem(params.obj_id));
			if (typeof d != 'object') {
				gui.log("no trackingdata");
				return;
			}
			
			
			/* from il2sop / il2tracking
			'{
				"client_data":[""],
				"user_data":["root","","root","user",null,"m","6"],
				"lm": [
					"SCORM Diagnostic SCO multi 20110926 1.2",
					null,
					"1.2",
					1,
					"{
						\"refId\":65,
						\"objId\":239,
						\"clientId\":\"forkSop2\",
						\"launchId\":6,
						\"launchNr\":0,
						\"pingSession\":0,
						\"studentId\":6,
						\"studentName\":\"user%2C%20root\",
						\"studentLogin\":\"root\",
						\"studentOu\":\"\",
						\"credit\":\"credit\",
						\"lesson_mode\":\"normal\",
						\"b_autoReview\":false,
						\"b_messageLog\":false,
						\"b_checkSetValues\":true,
						\"b_storeObjectives\":true,
						\"b_storeInteractions\":true,
						\"b_readInteractions\":false,
						\"c_storeSessionTime\":\"s\",
						\"b_autoContinue\":false,
						\"b_autoLastVisited\":true,
						\"b_sessionDeactivated\":true,
						\"i_lessonScoreMax\":-1,
						\"i_lessonMasteryScore\":\"\",
						\"b_debug\":false,\"a_itemParameter\":[],
						\"status\": {
							\"saved_global_status\":1,
							\"lp_mode\":6,
							\"scos\":[],
							\"hash\":7889303542,
							\"p\":\"6\",
							\"last_visited\":\"6\",
							\"total_time_sec\":0
						},
						\"dataDirectory\":\".%2Fdata%2FforkSop2%2Flm_data%2Flm_239%2F\",
						\"img\":{
							\"asset\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fasset.svg\",
							\"browsed\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fbrowsed.svg\",
							\"completed\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fcompleted.svg\",
							\"failed\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Ffailed.svg\",
							\"incomplete\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fincomplete.svg\",
							\"not_attempted\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fnot_attempted.svg\",
							\"passed\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fpassed.svg\",
							\"running\":\".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Frunning.svg\"
						},
						\"statusTxt\":{
							\"wait\":\"Bitte%20warten...\",
							\"status\":\"Status\",
							\"browsed\":\"Besucht\",
							\"completed\":\"Abgeschlossen\",
							\"failed\":\"Nicht%20bestanden\",
							\"incomplete\":\"Nicht%20vollst%C3%A4ndig\",
							\"not_attempted\":\"Nicht%20begonnen\",
							\"passed\":\"Bestanden\",
							\"running\":\"Aktiv\"
						}
					}",
					[
						[4,4,0,"proddingsco1.htm"],
						[6,5,0,"proddingsco2.htm"],
						[8,6,0,"proddingsco3.htm"],
						[10,7,0,"proddingsco4.htm"]
					],
					[
						[3,0,"SCORM%20Diagnostic%20SCO%20multi%2020110926","sor"],
						[4,1,"SCO%20ohne%20completion_threshold%20und%20ohne%20scaled_passing_score","sit"],
						[5,1,"SCO%20mit%20completion_threshold%20aber%20ohne%20scaled_passing_score","sit"],
						[6,1,"SCO%20ohne%20completion_threshold%20aber%20mit%20scaled_passing_score","sit"],
						[7,1,"SCO%20mit%20completion_threshold%20und%20mit%20scaled_passing_score","sit"]
					],
					"1",
					"",
					1,
					0,
					"0",
					null,
					"5.1.0 Beta 2 2015-10-26"
				],
				"sahs_user":["37","1","6",1436017846000,1449245287000,null,null,"0","2",null,""],
				"cmi":[
					[4,"cmi.core.credit","credit"],
					[4,"cmi.core.exit",""],
					[4,"cmi.core.lesson_mode","normal"],
					[4,"cmi.core.lesson_status","failed"],
					[4,"cmi.core.score.raw","94"],
					[7,"cmi.core.credit","credit"],
					[7,"cmi.core.exit",""],
					[7,"cmi.core.lesson_mode","normal"],
					[7,"cmi.core.lesson_status","failed"],
					[7,"cmi.core.score.raw","94"]
				]
			}'
			*/
			
			//var d = JSON.parse(gui.getData("lmGetAllByClientAndObjIdAtInitOfPlayer",[params.client,params.obj_id])); 
			/* from gui getData
			var d = [{"init_data":{
					"refId":18658,
					"objId":34108,
					"launchId":4359,
					"launchNr":0,
					"pingSession":0,
					"studentId":22583,
					"studentName":"Schneider%2C%20Stefan",
					"studentLogin":"sschneider",
					"studentOu":"",
					"credit":"credit",
					"lesson_mode":"normal",
					"b_autoReview":false,
					"b_messageLog":false,
					"b_checkSetValues":true,
					"b_storeObjectives":true,
					"b_storeInteractions":true,
					"b_readInteractions":false,
					"c_storeSessionTime":"s",
					"b_autoContinue":false,
					"b_autoLastVisited":true,
					"i_lessonScoreMax":-1,
					"i_lessonMasteryScore":-1,
					"b_debug":false,
					"a_itemParameter":[],
					"status":{
						"saved_global_status":1,
						"lp_mode":6,
						"scos":[
							"4356",
							"4357",
							"4358",
							"4359"
							],
							"hash":4377763270,
							"p":"22583",
							"last_visited":"4359",
							"total_time_sec":0
						},
					"dataDirectory":".%2Filias_fork%2Fdata%2Ftest50%2Flm_data%2Flm_34108%2F",
					"img":	{
						"asset":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fasset.svg",
						"browsed":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fbrowsed.svg",
						"completed":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fcompleted.svg",
						"failed":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Ffailed.svg",
						"incomplete":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fincomplete.svg",
						"not_attempted":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fnot_attempted.svg",
						"passed":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Fpassed.svg",
						"running":".%2Ftemplates%2Fdefault%2Fimages%2Fscorm%2Frunning.svg"},
						"statusTxt": {
							"wait":"Bitte%20warten...","status":
							"Status","browsed":"Besucht",
							"completed":"Abgeschlossen",
							"failed":"Nicht%20bestanden",
							"incomplete":"Nicht%20vollst%C3%A4ndig",
							"not_attempted":"Nicht%20begonnen",
							"passed":"Bestanden","running":"Aktiv"
							}
					},
					"resources":[
						[4,4356,0,"proddingsco1.htm"],
						[6,4357,0,"proddingsco2.htm"],
						[8,4358,0,"proddingsco3.htm"],
						[10,4359,0,"proddingsco4.htm"]
					],
					"scorm_tree":[
						[4355,0,"SCORM%20Diagnostic%20SCO%20multi%2020110926","sor"],
						[4356,1,"SCO%20ohne%20completion_threshold%20und%20ohne%20scaled_passing_score","sit"],
						[4357,1,"SCO%20mit%20completion_threshold%20aber%20ohne%20scaled_passing_score","sit"],
						[4358,1,"SCO%20ohne%20completion_threshold%20aber%20mit%20scaled_passing_score","sit"],
						[4359,1,"SCO%20mit%20completion_threshold%20und%20mit%20scaled_passing_score","sit"]
					],
					"module_version":1,
					"user_data":null,
					"last_visited":"4359",
					"status":1,
					"adlact_data":"null"
				}];
			*/
			gui.log("data: " + d);
			
			if(d[0].init_data && d[0].init_data!="")
			{
				IliasScormVars=d[0].init_data;
				IliasScormVars.launchId=d[0].last_visited;
				IliasScormVars.status.saved_global_status=d[0].status;
				IliasScormVars.dataDirectory='/ilias_fork/data/'+params.client+'/lm_data/lm_'+params.obj_id+'/';
				IliasScormResources=d[0].resources;
				if (IliasScormResources.length==1){
					document.getElementById("leftView").style.width="0";
					document.getElementById("dragbar").style.left="0";
					document.getElementById("tdResource").style.left="0";
				}
				if (IliasScormVars.b_debug==true) {
					document.getElementsByName("sahs_content")[0].style.height="70%";
					document.getElementsByName("logframe")[0].style.height="30%";
				}
				IliasScormTree = d[0].scorm_tree;
				IliasScormData = [];
				//IliasScormData = JSON.parse(gui.getData("getScormTracking",[params.client,params.obj_id],false));
				API=new iliasApi();
				
			}
			
			else {
				document.getElementById("tdResource").innerHTML="error reading data";
			}
			
		}
		
		function saveRequest(data){
			var dbResult = gui.setData("setSCORM12data",[params.client, params.obj_id, data]);
			return dbResult;
		}
		function scormPlayerUnload(data) {
			if(data.last!="") var dbResult = gui.setData("scormPlayerUnload",[params.client, params.obj_id, data.last]);
		}
	</script>
</body>
</html>
